---
import GoogleTagManager from '../components/GoogleTagManager.astro';
import GoogleAnalytics from '../components/GoogleAnalytics.astro';
import ZapierTracker from '../components/ZapierTracker.astro';
import ThemeToggle from '../components/ThemeToggle.astro';
import Clarity from '../components/Clarity.astro';
import BaseHead, { type Props as HeadProps } from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import Nav from '../components/Nav.astro';
import siteConfig from '../data/site-config';

export type Props = HeadProps & { showHeader?: boolean };

const { showHeader = true, ...head } = Astro.props;

// JSON-LD Schema
const jsonLd = {
    '@context': 'https://schema.org',
    '@type': 'WebSite',
    name: siteConfig.title || 'Default Title',
    url: 'https://www.emilingemarkarlsson.com',
    description: siteConfig.description || 'Default description',
    author: {
        '@type': 'Person',
        name: 'Emil Karlsson',
        description: 'Project Manager and Data Engineer based in Stockholm, Sweden',
        url: 'https://www.emilingemarkarlsson.com',
        sameAs: siteConfig.socialLinks?.map((link) => link.href).filter(Boolean) || []
    },
    image: {
        '@type': 'ImageObject',
        url: siteConfig.image?.src || 'https://www.example.com/default-image.jpg',
        alt: siteConfig.image?.alt || 'Default image alt text'
    }
};
---

<html lang="en" class="antialiased break-words">
    <head>
        <!-- Character Encoding -->
        <meta charset="UTF-8" />

        <!-- Google Tag Manager -->
        <GoogleTagManager gtmId="GTM-5MBF73WM" />

        <!-- Google Analytics -->
        <GoogleAnalytics measurementId="G-6EGDNMZKRL" />

        <!-- Zapier Tracker -->
        <ZapierTracker webhookUrl="https://hooks.zapier.com/hooks/catch/416486/2sd4r8l/" />

        <!-- Microsoft Clarity -->
        <Clarity />

        <!-- Base Meta Information -->
        <BaseHead {...head} />

        <!-- JSON-LD Schema -->
        <script type="application/ld+json" dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}></script>
    </head>
    <body class="bg-main text-main">
        <!-- Google Tag Manager (noscript) -->
        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5MBF73WM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
        </noscript>

        <!-- Page Structure -->
        <div class="flex flex-col min-h-screen px-4 md:px-8">
            <!-- Navigation -->
            <Nav />

            <!-- Header (Optional) -->
            {showHeader && <Header />}

            <!-- Main Content -->
            <main class="grow w-full max-w-3xl mx-auto">
                <slot />
            </main>

            <!-- Footer -->
            <Footer />
        </div>
    </body>
</html>